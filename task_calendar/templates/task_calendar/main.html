{% load static %}
<!DOCTYPE html>
<html lang="ja">

<head>
    {% include "main/html_head.html" %}
</head>

<body>
    <div class="container-fluid">

        {% include "main/header.html" %}
        <div class="row m-2">
            <div class="container">
                <div class = "row">
                    <h3 class = "m-2 border-bottom"> カレンダー</h3>
                </div>
                <div class = "row m-3">
                    <h5 class = "text-center"><button class = "btn btn-light" style = "margin-right:2cm" onclick = "get_calendar('b')">前月</button><span id = "year" style = "font-size:xx-large ">{{def_year}}</span> 年 <span id = "month" style = "font-size:xx-large ">{{def_month}}</span>月<button class = "btn btn-light" style = "margin-left:2cm" onclick = "get_calendar('next')">翌月</button></h5>
                    <table class="table border border-3 ">
                        <h2 class = "text-center" id = "loading">読込中...</h2>
                    </table>
                </div>
            <div class = "row"> <div class = "col text-center"><a class = "btn btn-primary" href = "{% url "index" %}">ホームへ戻る</a></div></div>
        </div>
    </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous">
    </script>

<script>
    let loading = document.getElementById("loading");
    async function get_calendar(to){
        loading.style = "visibility:visible";
        let contentMonth = document.getElementById("month");
        let contentYear = document.getElementById("year");
        let month = parseInt(document.getElementById("month").textContent);
        let year = parseInt(document.getElementById("year").textContent);
        if (to == "next"){
            if(1<= month && month <12){
                month += 1;
            }else{
                month = 1;
                year += 1;
            };
        }else{
            if(1< month && month <=12){
                month -= 1;
        }else{
            month = 12;
            year -= 1;
        }};
        contentMonth.textContent = month;
        contentYear.textContent = year;
        let table = document.getElementsByTagName("table")[0];
        let url = "{% url 'get_calendar' month='month' year='year' %}";
        url = url.replace("month", month).replace("year", year);

        let response = await fetch(url);
        let data = await response.text();
        table.innerHTML = data;
        loading.style = "visibility:hidden";
    }
    
    window.onload = async function get_init_calendar(){
        loading.style = "visibility:visible";
        let contentMonth = document.getElementById("month");
        let contentYear = document.getElementById("year");
        let month = parseInt(document.getElementById("month").textContent);
        let year = parseInt(document.getElementById("year").textContent);
        let table = document.getElementsByTagName("table")[0];
        let url = "{% url 'get_calendar' month='month' year='year' %}";
        url = url.replace("month", month).replace("year", year);
        let res = await fetch(url)
        let data = await res.text();
        table.innerHTML = data;
        loading.style = "visibility:hidden";
    }
</script>

<script src = "{% static "js/open_as_window.js" %}"></script>

</body>

</html>